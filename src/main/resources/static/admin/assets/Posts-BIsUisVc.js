import{d as j,r as f,a as A,m as H,c as _,e as t,w as a,g as o,C as L,b as d,x as O,i as u,y as $,z as w,t as m,F as q,D as J,l as K,G as Q,E as W,B as X,o as c,_ as Z}from"./index-C6t3W8sl.js";const ee={class:"post-management"},te={class:"search-bar"},ae={class:"user-info"},le={class:"content-cell"},ne={class:"media-preview"},oe=["src"],se={key:1},re={key:0},ie={key:1},de={class:"pagination"},ce=j({__name:"Posts",setup(pe){const v=f(!1),y=f([]),h=f(null),r=A({startDate:"",endDate:""}),i=f({page:1,size:10,total:0}),p=async()=>{v.value=!0;try{const n=await L({page:i.value.page,size:i.value.size,startDate:r.startDate,endDate:r.endDate});n.code===200&&n.data&&(y.value=n.data.list,i.value.total=n.data.total)}catch(n){console.error("Failed to fetch posts:",n)}finally{v.value=!1}},C=n=>{n?(r.startDate=n[0],r.endDate=n[1]):(r.startDate="",r.endDate="")},z=()=>{h.value=null,r.startDate="",r.endDate="",i.value.page=1,p()},x=n=>{K.confirm("确定要删除这条内容吗?删除后无法恢复!","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{(await Q(n.postId)).code===200&&(W.success("删除成功"),await p())}catch(l){console.error("Failed to delete post:",l)}})},T=n=>X(n).format("YYYY-MM-DD HH:mm:ss");return H(()=>{p()}),(n,l)=>{const M=o("el-date-picker"),D=o("el-form-item"),B=o("Search"),b=o("el-icon"),g=o("el-button"),E=o("Refresh"),I=o("el-form"),s=o("el-table-column"),V=o("el-avatar"),Y=o("el-tag"),U=o("el-popover"),P=o("el-rate"),S=o("el-table"),F=o("el-pagination"),R=o("el-card"),G=$("loading");return c(),_("div",ee,[t(R,null,{header:a(()=>[...l[3]||(l[3]=[d("div",{class:"card-header"},[d("span",null,"内容列表")],-1)])]),default:a(()=>[d("div",te,[t(I,{inline:!0,model:r},{default:a(()=>[t(D,{label:"日期范围"},{default:a(()=>[t(M,{modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=e=>h.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",onChange:C},null,8,["modelValue"])]),_:1}),t(D,null,{default:a(()=>[t(g,{type:"primary",onClick:p},{default:a(()=>[t(b,null,{default:a(()=>[t(B)]),_:1}),l[4]||(l[4]=u(" 搜索 ",-1))]),_:1}),t(g,{onClick:z},{default:a(()=>[t(b,null,{default:a(()=>[t(E)]),_:1}),l[5]||(l[5]=u(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),O((c(),w(S,{data:y.value,style:{width:"100%"},stripe:""},{default:a(()=>[t(s,{prop:"postId",label:"ID",width:"80"}),t(s,{label:"发布者",width:"150"},{default:a(({row:e})=>[d("div",ae,[t(V,{size:30,src:e.avatar},null,8,["src"]),d("span",null,m(e.nickname||e.username),1)])]),_:1}),t(s,{prop:"content",label:"内容","min-width":"250"},{default:a(({row:e})=>[d("div",le,m(e.content),1)]),_:1}),t(s,{prop:"mediaType",label:"类型",width:"100"},{default:a(({row:e})=>[t(Y,{type:e.mediaType==="IMAGE"?"success":e.mediaType==="VIDEO"?"warning":"info"},{default:a(()=>[u(m(e.mediaType==="IMAGE"?"图片":e.mediaType==="VIDEO"?"视频":"文本"),1)]),_:2},1032,["type"])]),_:1}),t(s,{label:"媒体",width:"100"},{default:a(({row:e})=>[e.mediaUrls&&e.mediaUrls.length>0?(c(),w(U,{key:0,placement:"right",width:400,trigger:"hover"},{reference:a(()=>[t(g,{size:"small",type:"primary",link:""},{default:a(()=>[u(" 查看("+m(e.mediaUrls.length)+") ",1)]),_:2},1024)]),default:a(()=>[d("div",ne,[(c(!0),_(q,null,J(e.mediaUrls,(k,N)=>(c(),_("img",{key:N,src:k,alt:"media",class:"preview-image"},null,8,oe))),128))])]),_:2},1024)):(c(),_("span",se,"无"))]),_:1}),t(s,{prop:"likeCount",label:"点赞",width:"80"}),t(s,{prop:"commentCount",label:"评论",width:"80"}),t(s,{prop:"viewCount",label:"浏览",width:"80"}),t(s,{label:"评分",width:"100"},{default:a(({row:e})=>[e.avgRating?(c(),_("div",re,[t(P,{"model-value":e.avgRating,disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"},null,8,["model-value"])])):(c(),_("span",ie,"暂无评分"))]),_:1}),t(s,{prop:"createTime",label:"发布时间",width:"180"},{default:a(({row:e})=>[u(m(T(e.createTime)),1)]),_:1}),t(s,{label:"操作",width:"100",fixed:"right"},{default:a(({row:e})=>[t(g,{type:"danger",size:"small",onClick:k=>x(e)},{default:a(()=>[...l[6]||(l[6]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,v.value]]),d("div",de,[t(F,{"current-page":i.value.page,"onUpdate:currentPage":l[1]||(l[1]=e=>i.value.page=e),"page-size":i.value.size,"onUpdate:pageSize":l[2]||(l[2]=e=>i.value.size=e),"page-sizes":[10,20,50,100],total:i.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","total"])])]),_:1})])}}}),ue=Z(ce,[["__scopeId","data-v-902d506a"]]);export{ue as default};
