<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨è£…é¥°åŒºåŸŸ -->
  <view class="header-section">
    <view class="header-bg"></view>
    <view class="header-content">
      <view class="welcome-text">
        <text class="welcome-title">å‘ç°ç²¾å½©</text>
        <text class="welcome-subtitle">æ¢ç´¢å¤šåª’ä½“ä¸–ç•Œ</text>
      </view>
      <view class="header-decoration">
        <text class="decoration-emoji">âœ¨</text>
      </view>
    </view>
  </view>
  
  <!-- æœç´¢å…¥å£ -->
  <view class="search-wrapper">
    <view class="search-entry" bindtap="goToSearch">
      <view class="search-icon-wrapper">
        <text class="search-icon">ğŸ”</text>
      </view>
      <text class="search-placeholder">æœç´¢å†…å®¹ã€ç”¨æˆ·ã€æ ‡ç­¾...</text>
      <view class="search-btn">
        <text>æœç´¢</text>
      </view>
    </view>
  </view>
  
  <!-- çƒ­é—¨æ ‡ç­¾ -->
  <scroll-view class="tag-scroll" scroll-x wx:if="{{hotTags.length > 0}}">
    <view class="tag-list">
      <view 
        class="tag-item {{currentTag === '' ? 'active' : ''}}"
        data-tag=""
        bindtap="selectTag"
      >
        <text class="tag-icon">ğŸŒŸ</text>
        <text>å…¨éƒ¨</text>
      </view>
      <view 
        class="tag-item {{currentTag === item.tagName ? 'active' : ''}}"
        wx:for="{{hotTags}}"
        wx:key="tagName"
        data-tag="{{item.tagName}}"
        bindtap="selectTag"
      >
        <text class="tag-icon">{{index % 5 === 0 ? 'ğŸ”¥' : (index % 5 === 1 ? 'ğŸ’«' : (index % 5 === 2 ? 'ğŸ¯' : (index % 5 === 3 ? 'ğŸŒˆ' : 'âš¡')))}}</text>
        <text>#{{item.tagName}}</text>
      </view>
    </view>
  </scroll-view>
  
  <!-- å¸–å­åˆ—è¡¨ -->
  <view class="post-list">
    <view 
      class="post-card"
      wx:for="{{posts}}"
      wx:key="postId"
      data-id="{{item.postId}}"
      bindtap="goToDetail"
    >
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="post-header">
        <view class="avatar-wrapper">
          <image class="avatar" src="{{item.avatar || 'https://via.placeholder.com/80'}}" mode="aspectFill"></image>
          <view class="avatar-ring"></view>
        </view>
        <view class="user-info">
          <text class="nickname">{{item.nickname || item.username}}</text>
          <text class="time">{{item.createTime}}</text>
        </view>
        <view class="more-btn">
          <text>Â·Â·Â·</text>
        </view>
      </view>
      
      <!-- å†…å®¹ -->
      <view class="post-content">{{item.content}}</view>
      
      <!-- åª’ä½“å†…å®¹ -->
      <view class="post-media" wx:if="{{item.mediaUrls && item.mediaUrls.length > 0}}">
        <!-- å›¾ç‰‡å±•ç¤º -->
        <block wx:if="{{item.mediaType === 'IMAGE'}}">
          <view class="image-grid image-count-{{item.mediaUrls.length > 4 ? 'many' : item.mediaUrls.length}}">
            <image 
              wx:for="{{item.mediaUrls}}" 
              wx:for-item="url"
              wx:for-index="idx"
              wx:key="idx"
              class="media-image"
              src="{{url}}" 
              mode="aspectFill"
              data-current="{{url}}"
              data-urls="{{item.mediaUrls}}"
              catchtap="previewImage"
            ></image>
          </view>
        </block>
        
        <!-- è§†é¢‘å±•ç¤º -->
        <block wx:elif="{{item.mediaType === 'VIDEO'}}">
          <view class="video-wrapper">
            <video 
              class="media-video"
              src="{{item.mediaUrls[0]}}" 
              controls
              show-center-play-btn
              object-fit="contain"
            ></video>
          </view>
        </block>
      </view>
      
      <!-- æ ‡ç­¾ -->
      <view class="post-tags" wx:if="{{item.tags && item.tags.length > 0}}">
        <text class="tag" wx:for="{{item.tags}}" wx:key="*this">#{{item}}</text>
      </view>
      
      <!-- äº’åŠ¨æ•°æ® -->
      <view class="post-footer">
        <view class="stat-item">
          <text class="stat-icon">ğŸ‘</text>
          <text class="stat-value">{{item.likeCount || 0}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-icon">ğŸ’¬</text>
          <text class="stat-value">{{item.commentCount || 0}}</text>
        </view>
        <view class="stat-item" wx:if="{{item.avgRating}}">
          <text class="stat-icon">â­</text>
          <text class="stat-value">{{item.avgRating}}</text>
        </view>
        <view class="stat-item share-btn">
          <text class="stat-icon">ğŸ“¤</text>
          <text class="stat-value">åˆ†äº«</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-more" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{!hasMore && posts.length > 0}}">
    <view class="no-more-line"></view>
    <text>å·²ç»åˆ°åº•å•¦</text>
    <view class="no-more-line"></view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && posts.length === 0}}">
    <view class="empty-illustration">
      <text class="empty-icon-bg">ğŸ“­</text>
      <view class="empty-sparkle sparkle-1">âœ¨</view>
      <view class="empty-sparkle sparkle-2">ğŸ’«</view>
      <view class="empty-sparkle sparkle-3">â­</view>
    </view>
    <text class="empty-title">æš‚æ— å†…å®¹</text>
    <text class="empty-hint">å¿«å»å‘å¸ƒç¬¬ä¸€æ¡åŠ¨æ€å§~</text>
    <view class="empty-action" bindtap="goToPublish">
      <text>å»å‘å¸ƒ</text>
    </view>
  </view>
</view>