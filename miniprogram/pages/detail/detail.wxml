<!--pages/detail/detail.wxml-->
<view class="container" wx:if="{{post}}">
  <!-- å¸–å­å†…å®¹ -->
  <view class="post-card">
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <view class="post-header">
      <image class="avatar" src="{{post.avatar || 'https://via.placeholder.com/80'}}" mode="aspectFill"></image>
      <view class="user-info">
        <text class="nickname">{{post.nickname || post.username}}</text>
        <text class="time">{{post.createTime}}</text>
      </view>
      <!-- æ“ä½œæŒ‰é’® -->
      <view class="actions" wx:if="{{isOwner}}">
        <text class="action-btn" bindtap="editPost">ç¼–è¾‘</text>
        <text class="action-btn danger" bindtap="deletePost">åˆ é™¤</text>
      </view>
    </view>
    
    <!-- å†…å®¹ -->
    <view class="post-content">
      <text class="content-text">{{post.content}}</text>
    </view>
    
    <!-- åª’ä½“ -->
    <view class="media-container" wx:if="{{post.mediaUrls && post.mediaUrls.length > 0}}">
      <block wx:if="{{post.mediaType === 'IMAGE'}}">
        <image 
          wx:for="{{post.mediaUrls}}"
          wx:key="*this"
          class="media-image"
          src="{{item}}"
          mode="widthFix"
          bindtap="previewImage"
          data-urls="{{post.mediaUrls}}"
          data-current="{{item}}"
        ></image>
      </block>
      <block wx:elif="{{post.mediaType === 'VIDEO'}}">
        <video 
          class="media-video"
          src="{{post.mediaUrls[0]}}"
          controls
          show-play-btn
        ></video>
      </block>
    </view>
    
    <!-- æ ‡ç­¾ -->
    <view class="tags" wx:if="{{post.tags && post.tags.length > 0}}">
      <text class="tag" wx:for="{{post.tags}}" wx:key="*this">#{{item}}</text>
    </view>
    
    <!-- ç»Ÿè®¡ -->
    <view class="stats">
      <like-button
        postId="{{post.postId}}"
        initialLiked="{{isLiked}}"
        initialCount="{{post.likeCount || 0}}"
        bind:likechanged="onLikeChanged"
      />
      <view class="stat-item">
        <text>ğŸ’¬ {{post.commentCount || 0}} è¯„è®º</text>
      </view>
      <view class="stat-item">
        <text>â­ {{post.avgRating || 0}} è¯„åˆ†</text>
      </view>
    </view>
  </view>
  
  <!-- è¯„åˆ†åŒºåŸŸ -->
  <view class="rating-section">
    <view class="section-title">ç»™è¿™ä¸ªå†…å®¹è¯„åˆ†</view>
    <view class="rating-stars">
      <view 
        class="star {{myRating >= index + 1 ? 'active' : ''}}"
        wx:for="{{[1,2,3,4,5]}}"
        wx:key="*this"
        data-score="{{index + 1}}"
        bindtap="onRating"
      >
        â­
      </view>
    </view>
    <text class="rating-text" wx:if="{{myRating > 0}}">æ‚¨çš„è¯„åˆ†: {{myRating}}åˆ†</text>
  </view>
  
  <!-- è¯„è®ºåŒºåŸŸ -->
  <view class="comment-section">
    <view class="section-title">è¯„è®º ({{comments.length}})</view>
    
    <!-- è¯„è®ºè¾“å…¥ -->
    <view class="comment-input-box">
      <input 
        class="comment-input"
        placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."
        value="{{commentInput}}"
        bindinput="onCommentInput"
      />
      <button 
        class="comment-btn"
        bindtap="submitComment"
        loading="{{submitting}}"
        disabled="{{submitting}}"
      >å‘é€</button>
    </view>
    
    <!-- è¯„è®ºåˆ—è¡¨ -->
    <view class="comment-list">
      <view class="comment-item" wx:for="{{comments}}" wx:key="commentId">
        <image class="comment-avatar" src="{{item.avatar || 'https://via.placeholder.com/60'}}" mode="aspectFill"></image>
        <view class="comment-content">
          <text class="comment-nickname">{{item.nickname || item.username}}</text>
          <text class="comment-text">{{item.content}}</text>
          <text class="comment-time">{{item.createTime}}</text>
        </view>
      </view>
      
      <view class="empty" wx:if="{{comments.length === 0}}">
        <text class="empty-text">æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘~</text>
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½ä¸­ -->
<view class="loading-page" wx:if="{{loading}}">
  <text>åŠ è½½ä¸­...</text>
</view>
