<!--pages/friends/friends.wxml-->
<view class="container">
  <!-- Tab åˆ‡æ¢ -->
  <view class="tab-bar">
    <view class="tab-item {{activeTab === 'list' ? 'active' : ''}}" bindtap="switchTab" data-tab="list">
      å¥½å‹åˆ—è¡¨
    </view>
    <view class="tab-item {{activeTab === 'add' ? 'active' : ''}}" bindtap="switchTab" data-tab="add">
      æ·»åŠ å¥½å‹
    </view>
    <view class="tab-item {{activeTab === 'requests' ? 'active' : ''}}" bindtap="switchTab" data-tab="requests">
      å¥½å‹ç”³è¯·
      <view wx:if="{{pendingCount > 0}}" class="badge">{{pendingCount}}</view>
    </view>
  </view>

  <!-- å¥½å‹åˆ—è¡¨ -->
  <view class="tab-content" wx:if="{{activeTab === 'list'}}">
    <view wx:if="{{friendList.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ‘¥</text>
      <text class="empty-text">æš‚æ— å¥½å‹</text>
      <text class="empty-hint">å»æ·»åŠ ä¸€äº›å¥½å‹å§</text>
    </view>
    
    <view class="friend-list" wx:else>
      <view class="friend-item" wx:for="{{friendList}}" wx:key="friend_id">
        <image wx:if="{{item.avatar}}" class="avatar" src="{{item.avatar}}" mode="aspectFill"/>
        <view wx:else class="avatar avatar-placeholder">ğŸ‘¤</view>
        <view class="friend-info">
          <text class="nickname">{{item.nickname || item.username}}</text>
          <text class="username">@{{item.username}}</text>
        </view>
        <view class="friend-actions">
          <button class="btn-delete" bindtap="deleteFriend" data-id="{{item.friend_id}}">åˆ é™¤</button>
        </view>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ å¥½å‹ -->
  <view class="tab-content" wx:if="{{activeTab === 'add'}}">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="è¾“å…¥ç”¨æˆ·åæˆ–æ˜µç§°æœç´¢" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="searchUsers"
      />
      <button class="btn-search" bindtap="searchUsers">æœç´¢</button>
    </view>

    <view wx:if="{{searchResults.length === 0 && hasSearched}}" class="empty-state">
      <text class="empty-icon">ğŸ”</text>
      <text class="empty-text">æœªæ‰¾åˆ°ç”¨æˆ·</text>
    </view>

    <view class="search-results" wx:if="{{searchResults.length > 0}}">
      <view class="user-item" wx:for="{{searchResults}}" wx:key="userId">
        <image wx:if="{{item.avatar}}" class="avatar" src="{{item.avatar}}" mode="aspectFill"/>
        <view wx:else class="avatar avatar-placeholder">ğŸ‘¤</view>
        <view class="user-info">
          <text class="nickname">{{item.nickname || item.username}}</text>
          <text class="username">@{{item.username}}</text>
        </view>
        <view class="user-actions">
          <button wx:if="{{item.isFriend}}" class="btn-status" disabled>å·²æ˜¯å¥½å‹</button>
          <button wx:elif="{{item.hasPendingRequest}}" class="btn-status" disabled>å·²ç”³è¯·</button>
          <button wx:else class="btn-add" bindtap="sendRequest" data-user="{{item}}">æ·»åŠ </button>
        </view>
      </view>
    </view>
  </view>

  <!-- å¥½å‹ç”³è¯· -->
  <view class="tab-content" wx:if="{{activeTab === 'requests'}}">
    <view wx:if="{{requestList.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— å¥½å‹ç”³è¯·</text>
    </view>

    <view class="request-list" wx:else>
      <view class="request-item" wx:for="{{requestList}}" wx:key="request_id">
        <image wx:if="{{item.avatar}}" class="avatar" src="{{item.avatar}}" mode="aspectFill"/>
        <view wx:else class="avatar avatar-placeholder">ğŸ‘¤</view>
        <view class="request-info">
          <text class="nickname">{{item.nickname || item.username}}</text>
          <text class="message" wx:if="{{item.message}}">{{item.message}}</text>
          <text class="message" wx:else>è¯·æ±‚æ·»åŠ æ‚¨ä¸ºå¥½å‹</text>
        </view>
        <view class="request-actions">
          <button class="btn-accept" bindtap="acceptRequest" data-id="{{item.request_id}}">åŒæ„</button>
          <button class="btn-reject" bindtap="rejectRequest" data-id="{{item.request_id}}">æ‹’ç»</button>
        </view>
      </view>
    </view>
  </view>
</view>
