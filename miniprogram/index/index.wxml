<!-- index/index.wxml -->
<!-- å¯¹æ¥ Spring Boot åç«¯çš„é¦–é¡µæ¨¡æ¿ -->
<view class="container">
  <!-- åˆ†ç±»å¯¼èˆªæ  -->
  <view class="category-nav">
    <view 
      wx:for="{{categories}}" 
      wx:key="key"
      class="category-item {{currentCategory === item.key ? 'active' : ''}}"
      data-category="{{item.key}}"
      bindtap="switchCategory"
    >
      <text>{{item.name}}</text>
    </view>
  </view>
  
  <!-- å¸–å­åˆ—è¡¨ -->
  <view class="post-list">
    <block wx:for="{{postList}}" wx:key="postId">
      <view class="post-item">
        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <view class="post-header">
          <image class="avatar" src="{{item.avatar || '/assets/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="user-info">
            <text class="nickname">{{item.nickname || item.username}}</text>
            <text class="time">{{item.createTime}}</text>
          </view>
        </view>
        
        <!-- å¸–å­å†…å®¹ -->
        <view class="post-content">
          <text class="content-text">{{item.content}}</text>
        </view>
        
        <!-- åª’ä½“å†…å®¹ -->
        <view class="media-container" wx:if="{{item.mediaUrls && item.mediaUrls.length > 0}}">
          <!-- å›¾ç‰‡ç±»å‹ -->
          <block wx:if="{{item.mediaType === 'IMAGE'}}">
            <view class="image-grid image-count-{{item.mediaUrls.length > 9 ? 9 : item.mediaUrls.length}}">
              <block wx:for="{{item.mediaUrls}}" wx:for-item="url" wx:for-index="idx" wx:key="idx">
                <image 
                  wx:if="{{idx < 9}}"
                  class="media-image" 
                  src="{{url}}" 
                  mode="aspectFill"
                  data-urls="{{item.mediaUrls}}"
                  data-current="{{url}}"
                  bindtap="previewImage"
                ></image>
              </block>
            </view>
          </block>
          
          <!-- è§†é¢‘ç±»å‹ -->
          <block wx:elif="{{item.mediaType === 'VIDEO'}}">
            <video 
              class="media-video"
              src="{{item.mediaUrls[0]}}" 
              controls 
              show-play-btn 
              show-center-play-btn
              object-fit="contain"
            ></video>
          </block>
        </view>
        
        <!-- æ ‡ç­¾ -->
        <view class="tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text class="tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">#{{tag}}</text>
        </view>
        
        <!-- äº’åŠ¨æ  -->
        <view class="post-footer">
          <view class="stat-item">
            <text class="stat-icon">ğŸ‘</text>
            <text class="stat-count">{{item.likeCount || 0}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-icon">ğŸ’¬</text>
            <text class="stat-count">{{item.commentCount || 0}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-icon">â­</text>
            <text class="stat-count">{{item.avgRating || 0}}</text>
          </view>
        </view>
      </view>
    </block>
  </view>
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <!-- ç©ºæ•°æ®æç¤º -->
  <view class="empty-container" wx:if="{{!loading && postList.length === 0}}">
    <text class="empty-text">æš‚æ— å†…å®¹</text>
  </view>
  
  <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
  <view class="no-more" wx:if="{{!hasMore && postList.length > 0}}">
    <text>â€” æ²¡æœ‰æ›´å¤šäº† â€”</text>
  </view>
</view>